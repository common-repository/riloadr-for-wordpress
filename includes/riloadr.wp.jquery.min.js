/*! 
 * Riloadr.js 1.3.2 (c) 2012 Tubal Martin - MIT license
 * 
 */ 
/**
 * @author Ole Vik
 * @description Updated for Riloadr-for-WordPress
 * @version 1.2.1
 * @fileOverview Directly edited to work with WordPress
 * @see <a href="https://github.com/OleVik/riloadr-wordpress">Riloadr-for-WordPress at GitHub</a>
 */
!function(definition){if(typeof define==='function'&&define.amd){define(['jquery'],definition);}else{window.Riloadr=definition(jQuery);}}(function($){'use strict';var ON='on',TRUE=!0,FALSE=!1,DELAY=250,NULL=null,LOAD='load',CALL='call',APPLY='apply',ERROR='error',EMPTYSTRING='',LENGTH='length',SCROLL='scroll',RESIZE='resize',ONLOAD=ON+LOAD,ONERROR=ON+ERROR,RETRIES='retries',COMPLETE='complete',RILOADED='riloaded',FALLBACK='fallback',CLASSNAME='className',PROTOTYPE='prototype',ONCOMPLETE=ON+COMPLETE,LOADIMAGES='loadImages',ORIENTATION='orientation',EVENTLISTENER='EventListener',ADDEVENTLISTENER='add'+EVENTLISTENER,ORIENTATIONCHANGE=ORIENTATION+'change',$win,body,win=window,doc=win.document,docElm=doc.documentElement,setTimeout=win.setTimeout,w3c=ADDEVENTLISTENER in doc,pre=w3c?EMPTYSTRING:ON,add=w3c?ADDEVENTLISTENER:'attachEvent',rem=w3c?'remove'+EVENTLISTENER:'detachEvent',QUESTION_MARK_REGEX=/\?/,BREAKPOINT_NAME_REGEX=/{breakpoint-name}/gi,orientationSupported=ORIENTATION in win&&ON+ORIENTATIONCHANGE in win,viewportWidth,screenWidth=win.screen.width,devicePixelRatio=win.devicePixelRatio||1,hasLowBandwidth=hasLowBandwidth(),operaMini=Object[PROTOTYPE].toString[CALL](win.operamini)==='[object OperaMini]',lastOrientation;docElm[CLASSNAME]=docElm[CLASSNAME].replace(/(^|\s)no-js(\s|$)/,'$1$2');function Riloadr(options){var instance=this,base=options.base||EMPTYSTRING,breakpoints=options.breakpoints||error('"breakpoints" not defined.'),className=options.name||'responsive',classNameRegexp=new RegExp('(^|\\s)'+className+'(\\s|$)'),deferMode=options.defer&&(options.defer).toLowerCase()||FALSE,foldDistance=options.foldDistance||100,ignoreLowBandwidth=options.ignoreLowBandwidth||FALSE,retries=options[RETRIES]||0,root=options.root||NULL,belowfoldEnabled=deferMode==='belowfold'&&!operaMini,scrollListener=belowfoldEnabled&&throttle(function(){instance[LOADIMAGES]();},DELAY),resizeListener=belowfoldEnabled&&debounce(function(){instance[LOADIMAGES]();},DELAY),orientationchangeListener=belowfoldEnabled&&debounce(function(){if(win[ORIENTATION]!==lastOrientation){lastOrientation=win[ORIENTATION];instance[LOADIMAGES]();}},DELAY),images=[],imagesPendingLoad=0,breakpoint,breakpointName,fallbackBreakpointName;function addBelowfoldListeners(){addEvent(win,SCROLL,scrollListener);addEvent(win,RESIZE,resizeListener);if(orientationSupported){lastOrientation=win[ORIENTATION];addEvent(win,ORIENTATIONCHANGE,orientationchangeListener);}}
function removeBelowfoldListeners(){removeEvent(win,SCROLL,scrollListener);removeEvent(win,RESIZE,resizeListener);orientationSupported&&removeEvent(win,ORIENTATIONCHANGE,orientationchangeListener);}
function loadImage(img,idx){img[RETRIES]=0;img[FALLBACK]=FALSE;img[ONLOAD]=imageOnloadCallback;img[ONERROR]=imageOnerrorCallback;img.src=getImageSrc(img,base,breakpointName);images.splice(idx,1);}
function imageOnloadCallback(){var img=this;img[ONLOAD]=img[ONERROR]=NULL;img[CLASSNAME]=img[CLASSNAME].replace(classNameRegexp,'$1$2');ONLOAD in options&&options[ONLOAD][CALL](img);onCompleteCallback();}
function imageOnerrorCallback(){var img=this;ONERROR in options&&options[ONERROR][CALL](img);if(img[RETRIES]<retries){img[RETRIES]++;img.src=getImageSrc(img,base,(img[FALLBACK]?fallbackBreakpointName:breakpointName),TRUE);}else if(FALLBACK in breakpoint&&!img[FALLBACK]){img[RETRIES]=0;img[FALLBACK]=TRUE;img.src=getImageSrc(img,base,fallbackBreakpointName);}else{onCompleteCallback();}}
function onCompleteCallback(){imagesPendingLoad--;imagesPendingLoad==0&&ONCOMPLETE in options&&options[ONCOMPLETE]();}
instance[LOADIMAGES]=function(update){defer(function(current,i){if(!images[LENGTH]||update===TRUE){belowfoldEnabled&&addBelowfoldListeners();$('img.'+className,root).each(function(idx,elm){if(elm&&!elm[RILOADED]){elm[RILOADED]=TRUE;images.push(elm);imagesPendingLoad++;}});}
if(images[LENGTH]){i=0;while(current=images[i]){if(current&&(!belowfoldEnabled||belowfoldEnabled&&!isBelowTheFold(current,foldDistance))){loadImage(current,i);i--;}
i++;}}
belowfoldEnabled&&!images[LENGTH]&&removeBelowfoldListeners();current=NULL;});};onDomReady(function(){$win=$(win);body=doc.body;root=root&&$('#'+root)||body;viewportWidth=viewportWidth||getViewportWidthInCssPixels();breakpoint=getBreakpoint(breakpoints,viewportWidth,ignoreLowBandwidth);breakpointName=breakpoint.name;fallbackBreakpointName=breakpoint[FALLBACK];if(!deferMode||belowfoldEnabled){instance[LOADIMAGES]();}else{onWindowReady(instance[LOADIMAGES]);}});}
Riloadr.version='1.3.2';Riloadr[PROTOTYPE].riload=function(){this[LOADIMAGES](TRUE);};function getBreakpoint(breakpoints,vWidth,ignoreLowBandwidth){var _vWidth=vWidth,i=0,breakpoint={},_breakpoint,minWidth,maxWidth,minDpr;while(_breakpoint=breakpoints[i]){minWidth=_breakpoint['minWidth'];maxWidth=_breakpoint['maxWidth'];minDpr=_breakpoint['minDevicePixelRatio'];if(vWidth>0){if(minWidth&&maxWidth&&vWidth>=minWidth&&vWidth<=maxWidth||minWidth&&!maxWidth&&vWidth>=minWidth||maxWidth&&!minWidth&&vWidth<=maxWidth){if(!minDpr||minDpr&&devicePixelRatio>=minDpr&&(ignoreLowBandwidth||!ignoreLowBandwidth&&!hasLowBandwidth)){breakpoint=_breakpoint;}}}else if(_vWidth<=0||minWidth<_vWidth||maxWidth<_vWidth){_vWidth=minWidth||maxWidth||_vWidth;breakpoint=_breakpoint;}
i++;}
return breakpoint;}
function getViewportWidthInCssPixels(){var math=Math,widths=[docElm.clientWidth,docElm.offsetWidth,body.clientWidth],screenWidthFallback=math.ceil(screenWidth/devicePixelRatio),l=widths[LENGTH],i=0,width;for(;i<l;i++){if(isNaN(widths[i])){widths.splice(i,1);i--;}}
if(widths[LENGTH]){width=math.max[APPLY](math,widths);if(!isNaN(screenWidthFallback)){width=math.min(screenWidthFallback,width);}}
return width||screenWidthFallback||0;}
function getImageSrc(img,base,breakpointName,reload){var src=(img.getAttribute('data-base')||base)+
(img.getAttribute('data-src')||EMPTYSTRING);var imgWidth=parseInt(img.getAttribute('wdt'));var imgHeight=parseInt(img.getAttribute('hgt'));var relativeHeight=Math.floor(breakpointName*(imgHeight/imgWidth));var returnSize='-'+breakpointName+'x'+relativeHeight;if(reload){src+=(QUESTION_MARK_REGEX.test(src)?'&':'?')+'riloadrts='+(new Date).getTime();}
return src.replace(BREAKPOINT_NAME_REGEX,returnSize);}
function isBelowTheFold(img,foldDistance){return $win.height()+$win.scrollTop()<=$(img).offset().top-foldDistance;}
function hasLowBandwidth(){var navigator=win.navigator,connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection||navigator.oConnection||navigator.msConnection||{},type=connection.type||'unknown',bandwidth=+connection.bandwidth||Infinity;return bandwidth>0&&bandwidth<0.1||/^[23]g|3|4$/.test(type+EMPTYSTRING);}
function throttle(func,wait){var args,result,thisArg,timeoutId,lastCalled=0;function trailingCall(){lastCalled=new Date;timeoutId=NULL;func[APPLY](thisArg,args);}
return function(){var now=new Date,remain=wait-(now-lastCalled);args=arguments;thisArg=this;if(remain<=0){lastCalled=now;result=func[APPLY](thisArg,args);}else if(!timeoutId){timeoutId=setTimeout(trailingCall,remain);}
return result;};}
function debounce(func,wait,immediate){var args,result,thisArg,timeoutId;function delayed(){timeoutId=NULL;if(!immediate){func[APPLY](thisArg,args);}}
return function(){var isImmediate=immediate&&!timeoutId;args=arguments;thisArg=this;clearTimeout(timeoutId);timeoutId=setTimeout(delayed,wait);if(isImmediate){result=func[APPLY](thisArg,args);}
return result;};}
function defer(func){var args=Array[PROTOTYPE].slice[CALL](arguments,1);setTimeout(function(){return func[APPLY](NULL,args);},1);}
function error(msg){throw new Error('Riloadr: '+msg);}
function addEvent(elem,type,fn){elem[add](pre+type,fn,FALSE);}
function removeEvent(elem,type,fn){elem[rem](pre+type,fn,FALSE);}
function onDomReady(fn){$(fn);}
function onWindowReady(fn){if(doc['readyState']===COMPLETE){fn();}else{var _fn=function(){removeEvent(win,LOAD,_fn);fn();};addEvent(win,LOAD,_fn);}}
return Riloadr;});var riloadr=new Riloadr({name:'riloadr',base:'',onerror:function(){var title=jQuery(this).attr('title');var data_src=jQuery(this).attr('data-src');var src=data_src.replace('{breakpoint-name}','');jQuery('img[title="'+title+'"]').removeAttr('src');jQuery('img[title="'+title+'"]').attr('src',src);},defer:defer,ignoreLowBandwidth:ignorelowbandwidth,breakpoints:image_sizes});